# üîê H∆∞·ªõng d·∫´n C·∫•u h√¨nh M√¥i tr∆∞·ªùng (.env)

## T·ªïng quan

D·ª± √°n Seefood s·ª≠ d·ª•ng c√°c file `.env` ƒë·ªÉ qu·∫£n l√Ω c·∫•u h√¨nh m√¥i tr∆∞·ªùng. **KH√îNG BAO GI·ªú** hardcode c√°c gi√° tr·ªã nh∆∞ database credentials, API keys, ho·∫∑c URLs trong code.

---

## üìÅ C·∫•u tr√∫c File Environment

```
Seefood/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ .env                    # File c·∫•u h√¨nh th·ª±c t·∫ø (KH√îNG commit)
‚îÇ   ‚îî‚îÄ‚îÄ .env.example            # Template m·∫´u (commit ƒë∆∞·ª£c)
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ .env.local              # File c·∫•u h√¨nh th·ª±c t·∫ø (KH√îNG commit)
‚îÇ   ‚îî‚îÄ‚îÄ .env.example            # Template m·∫´u (commit ƒë∆∞·ª£c)
‚îî‚îÄ‚îÄ .gitignore                  # ƒê·∫£m b·∫£o .env v√† .env.local b·ªã ignore
```

---

## üîß Backend Configuration

### File: `backend/.env`

```env
# Django Settings
SECRET_KEY=django-insecure-dev-change-this-in-production-12345
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Database Configuration (PostgreSQL)
DB_NAME=seafood_db
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=localhost
DB_PORT=5432

# Redis Configuration (for Django Channels WebSocket)
REDIS_HOST=localhost
REDIS_PORT=6379

# CORS Configuration
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# JWT Configuration
JWT_SECRET_KEY=your-jwt-secret-key-change-in-production
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=1440

# Server Configuration
HOST=0.0.0.0
PORT=8000

# File Upload
UPLOAD_DIR=media
MAX_FILE_SIZE=10485760
```

### C√°ch s·ª≠ d·ª•ng trong Django:

```python
from decouple import config

# Settings example
SECRET_KEY = config('SECRET_KEY', default='fallback-value')
DEBUG = config('DEBUG', default=True, cast=bool)
ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='localhost').split(',')

# Database
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': config('DB_NAME', default='seafood_db'),
        'USER': config('DB_USER', default='postgres'),
        'PASSWORD': config('DB_PASSWORD', default='postgres'),
        'HOST': config('DB_HOST', default='localhost'),
        'PORT': config('DB_PORT', default='5432'),
    }
}

# Redis (Channels)
CHANNEL_LAYERS = {
    'default': {
        'BACKEND': 'channels_redis.core.RedisChannelLayer',
        'CONFIG': {
            "hosts": [(
                config('REDIS_HOST', default='localhost'),
                config('REDIS_PORT', default=6379, cast=int)
            )],
        },
    },
}
```

**ƒê√£ ƒë∆∞·ª£c implement t·∫°i**: [backend/config/settings/base.py](backend/config/settings/base.py)

---

## üåê Frontend Configuration

### File: `frontend/.env.local`

```env
# Backend API URL (HTTP)
NEXT_PUBLIC_API_URL=http://localhost:8000

# WebSocket URL (WS)
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws/orders/
```

### Production Example:

```env
# Production configuration
NEXT_PUBLIC_API_URL=https://api.seefood.com
NEXT_PUBLIC_WS_URL=wss://api.seefood.com/ws/orders/
```

### C√°ch s·ª≠ d·ª•ng trong Next.js:

```typescript
// Trong code TypeScript/JavaScript
const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';
const WS_URL = process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:8000/ws/orders/';

// Example: API client
const apiClient = axios.create({
  baseURL: `${process.env.NEXT_PUBLIC_API_URL}/api`,
});

// Example: WebSocket connection
const socket = new WebSocket(process.env.NEXT_PUBLIC_WS_URL);
```

**ƒê√£ ƒë∆∞·ª£c implement t·∫°i**:
- API client: [frontend/lib/api.ts](frontend/lib/api.ts)
- WebSocket: [frontend/lib/redux/ReduxProvider.tsx](frontend/lib/redux/ReduxProvider.tsx)

---

## üöÄ Setup M√¥i tr∆∞·ªùng Development

### B∆∞·ªõc 1: Copy file example

```bash
# Backend
cd backend
cp .env.example .env

# Frontend
cd ../frontend
cp .env.example .env.local
```

### B∆∞·ªõc 2: Customize c√°c gi√° tr·ªã

Ch·ªânh s·ª≠a file `.env` v√† `.env.local` theo m√¥i tr∆∞·ªùng c·ªßa b·∫°n:

**Backend `.env`**:
- ƒê·ªïi `SECRET_KEY` th√†nh key ng·∫´u nhi√™n (generate m·ªõi)
- ƒê·ªïi `DB_PASSWORD` n·∫øu PostgreSQL c√≥ password kh√°c
- ƒê·ªïi `REDIS_HOST` th√†nh `redis` n·∫øu ch·∫°y trong Docker network

**Frontend `.env.local`**:
- Gi·ªØ nguy√™n n·∫øu ch·∫°y local
- ƒê·ªïi URL n·∫øu backend ch·∫°y tr√™n port kh√°c

### B∆∞·ªõc 3: Verify configuration

```bash
# Backend - test database connection
cd backend
python manage.py check

# Frontend - test build
cd frontend
npm run build
```

---

## üê≥ Docker Configuration

Khi ch·∫°y v·ªõi Docker Compose, c·∫ßn update:

### File: `backend/.env` (for Docker)

```env
# Database Host ph·∫£i tr·ªè t·ªõi service name trong docker-compose.yml
DB_HOST=db          # Thay v√¨ localhost

# Redis Host
REDIS_HOST=redis    # Thay v√¨ localhost
```

### File: `docker-compose.yml`

```yaml
services:
  backend:
    environment:
      - DB_HOST=db
      - REDIS_HOST=redis
    env_file:
      - ./backend/.env
```

---

## üîí Security Best Practices

### ‚úÖ DO:

1. **S·ª≠ d·ª•ng .env files cho t·∫•t c·∫£ secrets**
   ```python
   SECRET_KEY = config('SECRET_KEY')  # ‚úÖ
   ```

2. **Add .env v√†o .gitignore**
   ```gitignore
   # Environment files
   .env
   .env.local
   .env.*.local
   ```

3. **Commit .env.example v·ªõi dummy values**
   ```env
   SECRET_KEY=change-me-in-production
   ```

4. **Generate strong secrets cho production**
   ```python
   # Django secret key generator
   from django.core.management.utils import get_random_secret_key
   print(get_random_secret_key())
   ```

5. **S·ª≠ d·ª•ng default values an to√†n**
   ```python
   DEBUG = config('DEBUG', default=False, cast=bool)  # ‚úÖ Safe default
   ```

### ‚ùå DON'T:

1. **KH√îNG hardcode credentials**
   ```python
   PASSWORD = "postgres"  # ‚ùå BAD
   PASSWORD = config('DB_PASSWORD')  # ‚úÖ GOOD
   ```

2. **KH√îNG commit file .env**
   ```bash
   git add .env  # ‚ùå NEVER DO THIS
   ```

3. **KH√îNG ƒë·ªÉ DEBUG=True trong production**
   ```env
   DEBUG=False  # ‚úÖ Production
   ```

4. **KH√îNG d√πng default secrets trong production**
   ```env
   SECRET_KEY=change-this-in-production  # ‚ùå Must change
   ```

---

## üì¶ Environment Variables Reference

### Backend Variables

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `SECRET_KEY` | string | (required) | Django secret key |
| `DEBUG` | boolean | False | Debug mode |
| `ALLOWED_HOSTS` | string | localhost | Comma-separated hosts |
| `DB_NAME` | string | seafood_db | Database name |
| `DB_USER` | string | postgres | Database user |
| `DB_PASSWORD` | string | postgres | Database password |
| `DB_HOST` | string | localhost | Database host |
| `DB_PORT` | integer | 5432 | Database port |
| `REDIS_HOST` | string | localhost | Redis host |
| `REDIS_PORT` | integer | 6379 | Redis port |
| `CORS_ALLOWED_ORIGINS` | string | localhost:3000 | CORS origins |
| `JWT_SECRET_KEY` | string | (required) | JWT signing key |
| `JWT_ALGORITHM` | string | HS256 | JWT algorithm |
| `JWT_ACCESS_TOKEN_EXPIRE_MINUTES` | integer | 1440 | Token expiry |

### Frontend Variables

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `NEXT_PUBLIC_API_URL` | string | http://localhost:8000 | Backend API URL |
| `NEXT_PUBLIC_WS_URL` | string | ws://localhost:8000/ws/orders/ | WebSocket URL |

---

## üåç Environment-specific Configurations

### Development

```env
# backend/.env
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
DB_HOST=localhost
REDIS_HOST=localhost

# frontend/.env.local
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws/orders/
```

### Staging

```env
# backend/.env
DEBUG=False
ALLOWED_HOSTS=staging.seefood.com
DB_HOST=staging-db.internal
REDIS_HOST=staging-redis.internal

# frontend/.env.local
NEXT_PUBLIC_API_URL=https://staging-api.seefood.com
NEXT_PUBLIC_WS_URL=wss://staging-api.seefood.com/ws/orders/
```

### Production

```env
# backend/.env
DEBUG=False
SECRET_KEY=<long-random-production-key>
ALLOWED_HOSTS=api.seefood.com
DB_HOST=production-db.internal
DB_PASSWORD=<strong-password>
REDIS_HOST=production-redis.internal

# frontend/.env.local
NEXT_PUBLIC_API_URL=https://api.seefood.com
NEXT_PUBLIC_WS_URL=wss://api.seefood.com/ws/orders/
```

---

## üîç Troubleshooting

### Issue: "Environment variable not found"

**Solution**: ƒê·∫£m b·∫£o file `.env` t·ªìn t·∫°i v√† c√≥ bi·∫øn ƒë√≥:
```bash
cat backend/.env | grep VARIABLE_NAME
```

### Issue: "Database connection failed"

**Solution**: Check DB variables:
```bash
# Backend
python manage.py check --database default

# Or test manually
psql -h localhost -U postgres -d seafood_db
```

### Issue: "WebSocket connection refused"

**Solution**: Check WebSocket URL:
```javascript
console.log(process.env.NEXT_PUBLIC_WS_URL);
// Should output: ws://localhost:8000/ws/orders/
```

### Issue: "CORS error"

**Solution**: Update CORS_ALLOWED_ORIGINS:
```env
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://192.168.1.100:3000
```

---

## üìö Related Documentation

- [Django Decouple](https://github.com/HBNetwork/python-decouple)
- [Next.js Environment Variables](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)
- [Django Settings Best Practices](https://docs.djangoproject.com/en/5.0/topics/settings/)

---

## ‚úÖ Checklist

- [ ] Copy `.env.example` to `.env` cho backend
- [ ] Copy `.env.example` to `.env.local` cho frontend
- [ ] Update `SECRET_KEY` v·ªõi gi√° tr·ªã m·ªõi
- [ ] Update `DB_PASSWORD` n·∫øu c·∫ßn
- [ ] Update `REDIS_HOST` cho Docker (n·∫øu d√πng)
- [ ] Verify `.env` files trong `.gitignore`
- [ ] Test connection v·ªõi `python manage.py check`
- [ ] Test frontend build v·ªõi `npm run build`

---

**Last Updated**: 2025-01-05
**Version**: 1.0.0
